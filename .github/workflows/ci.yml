name: Spring Boot Microservices CI

on:
    push:
        branches: ["main", "develop"]
    pull_request:
        branches: ["main", "develop"]

jobs:
    build-test:
        name: Build & Test Microservices
        runs-on: ubuntu-latest

        strategy:
            matrix:
                service:
                    - config-service
                    - discovery-service
                    - customer-service
                    - order-service
                    - product-service

        steps:
            - name: Checkout repository
              uses: actions/checkout@v4

            - name: Set up JDK 17
              uses: actions/setup-java@v4
              with:
                  java-version: "17"
                  distribution: "temurin"
                  cache: maven

            - name: Build & Test ${{ matrix.service }}
              working-directory: ./${{ matrix.service }}
              run: mvn clean verify

            - name: Upload test reports
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: test-reports-${{ matrix.service }}
                  path: ${{ matrix.service }}/target/surefire-reports
